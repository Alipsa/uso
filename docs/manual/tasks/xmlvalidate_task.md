# xmlvalidate

The `xmlvalidate` task checks XML files for well-formedness and validates them against DTDs or XML Schemas (XSD). It supports nested resource collections, custom validation options, and configurable error handling. 

The task uses the SAX2 parser implementation provided by JAXP by default (probably the one that is used by Apache Ant itself), but one can specify any SAX1/2 parser if needed.

By default, JAXP creates a non namespace aware parser. The http://xml.org/sax/features/namespaces feature is set by default to false by the JAXP implementation used by Ant. To validate a document containing namespaces, set the namespaces feature to true explicitly by nesting the following element:
```xml
<attribute name="http://xml.org/sax/features/namespaces" value="true"/>
```
If you are using for instance a xsi:noNamespaceSchemaLocation attribute in your XML files, you will need this namespace support feature.

If you are using a parser not generated by JAXP, by using the classname attribute of xmlvalidate, this warning may not apply.

## Usage Examples

```groovy
// Validate a single XML file against its DOCTYPE or internal schema
target('checkWellFormed') {
  xmlvalidate(file: 'config/app.xml')
}

// Validate multiple XML files against an external XSD
target('validateWithXsd') {
  xmlvalidate(
      file:'xml/endpiece-noSchema.xml', 
      lenient:'false',
      failonerror:'true', 
      warn:'true'
  ) {
    attribute(name:'http://apache.org/xml/features/validation/schema', value:'true')
    attribute(name:'http://xml.org/sax/features/namespaces', value:'true')
    property(name:'http://apache.org/xml/properties/schema/external-noNamespaceSchemaLocation', value:'${xsd.file}')
  }
}

// Scan all XML files in the project, using the catalog defined inline.
target('validateWithCatalog') {
  xmlvalidate(failonerror="no") {
    fileset(dir: 'config', includes: '*.xml')
    xmlcatalog() {
      dtd(
          publicId: "-//ArielPartners//DTD XML Article V1.0//EN", 
          location: "com/arielpartners/knowledgebase/dtd/article.dtd"
      ) 
    }
  }
}
```

## Attributes

| Attribute            | Description                                                                                                          | Required                   |
|----------------------|----------------------------------------------------------------------------------------------------------------------|----------------------------|
| `file`               | Path to the XML file to validate. Required if no nested resource collections are provided.                           | Conditional                |
| `schema`             | Path to the XML Schema (XSD) to use for validation; if omitted, the task will use DTD based on DOCTYPE declarations. | No                         |
| `catalog`            | Path to an XML Catalog file for resolving DTDs or schema locations.                                                  | No                         |
| `rejectUnauthorized` | Whether to reject XML resources from external locations if not found in catalog (`true                               | false`, default: `true`).  | No       |
| `validation`         | Validation mode: `strict`, `lenient`, or `auto` (default: `auto`).                                                   | No                         |
| `failOnWarning`      | Whether to treat validation warnings as errors (`true                                                                | false`, default: `true`).  | No       |
| `failOnError`        | Whether to halt the build on validation errors (`true                                                                | false`, default: `true`).  | No       |
| `quiet`              | Suppress informational messages (`true                                                                               | false`, default: `false`). | No       |
| `classname`          | Custom validator class implementing `javax.xml.validation.SchemaFactory`; use for non-standard schema languages.     | No                         |
| `classpathref`       | Reference to a `<path>` element containing the classpath for custom validator classes.                               | No                         |

## Nested Elements

- **Resource Collections**: `<fileset>`, `<filelist>`, `<path>`, etc., to specify multiple XML files.
- `xmlcatalog`: Define an inline XML Catalog resource using nested `<dtd>`.
- `attribute`: The attribute element is used to set parser features. Features usable with the Xerces parser are defined here: [Setting Features](https://xml.apache.org/xerces-j/features.html). SAX features are defined here: [SAX2 Standard Feature Flags](http://www.saxproject.org/apidoc/org/xml/sax/package-summary.html#package_description)

## Notes

- By default, external entity resolution is controlled by the XML Catalog; set `rejectUnauthorized` to allow or disallow remote retrieval.
- `validation="auto"` will choose DTD or XSD based on available declarations.
- Use `quiet: true` to reduce log noise for large validations.

## Reference

- [Ant Manual: xmlvalidate Task](https://ant.apache.org/manual/Tasks/xmlvalidate.html)
